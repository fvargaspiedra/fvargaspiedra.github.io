<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="style.css">
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="jquery-1.11.3.js"></script>
		<script src="jquery.fullPage.min.js"></script>
		<link rel="stylesheet" href="jquery.fullPage.css">
		<link href="https://fonts.googleapis.com/css?family=Raleway|Oxigen" rel="stylesheet">
	</head>
	<body>
		<div id="wrapper">
			<div class="section">
				Fertility Rate:
				A curious case of correlations
			</div>
			<div class="section">
				<div id="section1_graph">
					<svg id="byCountryFertilityRate" width="1000" height="500"></svg>
				</div>				
			</div>
			<div class="section">
				<div id="section2_graph">
					<div id="player">
						<button name="play" id="play">Play</button><br/><br/>
						<input id="slider" style="width:200px;" type="range" min="1960" max="2015" value="1960" step="1" />
						<span id="range">1960</span><br/>
					</div>
					<svg id="FertilityRateVsGDP" width="800" height="450"></svg>
				</div>
			</div>
			<div class="section">
				<svg id="FertilityRateVsHapiness" width="1000" height="500"></svg>
			</div>
			<div class="section">
				<svg id="FertilityRateVsReligion" width="1000" height="500"></svg>
			</div>
		</div>
		<div id="footer">About this visualization</div>
		<script>

			$(document).ready(function() {
				$('#wrapper').fullpage({
					sectionsColor: ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
					navigation: true,
					navigationPosition: 'right',
					navigationTooltips: ['Introduction', 'FR by Country', 'FR vs GDP', 'FR vs Happiness', 'FR and Religion']
				});
			});

			// ***************************************************
			// ******* FERTILITY RATE BY COUNTRY OVERVIEW ********
			// ***************************************************

			// ******** Variable definition *********	
			
			var div = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);

			// Parse time for yearly data		
			var parseDate = d3.timeParse("%Y");
			var formatTime = d3.timeFormat("%Y");

			// SVG to be modified selection
			var vis = d3.select("#byCountryFertilityRate");

			// Dimensions
			var	MARGINS = { top: 20, right: 300, bottom: 130, left: 50 },
				MARGINS2 = { top: 410, right: 300, bottom: 50, left: 50 },
				WIDTH = +vis.attr("width") - MARGINS.left - MARGINS.right,
				HEIGHT = +vis.attr("height") - MARGINS.top - MARGINS.bottom,
				HEIGHT2 = +vis.attr("height") - MARGINS2.top - MARGINS2.bottom;

			// Scales
			var xScale = d3.scaleTime().range([0, WIDTH]),
				xScale2 = d3.scaleTime().range([0, WIDTH]),
				yScale = d3.scaleLinear().range([HEIGHT, 0]),
				yScale2 = d3.scaleLinear().range([HEIGHT2, 0]);

			// gridlines in x axis function
			function make_x_gridlines() {		
			    return d3.axisBottom(xScale)
			        .ticks(10)
			}

			// gridlines in y axis function
			function make_y_gridlines() {		
			    return d3.axisLeft(yScale)
			        .ticks(10)
			}

			// Axis
			var	xAxis = d3.axisBottom(xScale),
				xAxis2 = d3.axisBottom(xScale2),
				yAxis = d3.axisLeft(yScale);

			// Line color
			var color = d3.scaleOrdinal(d3.schemeCategory10);

			// Define brush call
			var brush = d3.brushX()
			    .extent([[0, 0], [WIDTH, HEIGHT2]])
			    .on("brush end", brushed);

			// Append class focus that will be used to draw the charts
			var focus = vis.append("g")
			    .attr("class", "focus")
			    .attr("transform", "translate(" + MARGINS.left + "," + MARGINS.top + ")");

			// Append class context that will be used to draw the charts in the context bar
			var context = vis.append("g")
			    .attr("class", "context")
			    .attr("transform", "translate(" + MARGINS2.left + "," + MARGINS2.top + ")");

			// Append class context that will be used to draw the points in the focus bar
			var points = vis.append("g")
			    .attr("class", "points")
			    .attr("transform", "translate(" + MARGINS.left + "," + MARGINS.top + ")");

			// Line definition for focus section
			var lineGen = d3.line()
				.x(function(d) { return xScale(d.Year); })
				.y(function(d) { return yScale(d.Fertility_Rate); });

			// Line definition for context section
			var lineGen2 = d3.line()
				.x(function(d) { return xScale2(d.Year); })
				.y(function(d) { return yScale2(d.Fertility_Rate); });

			// ******** Append section *********	

			// clipPath for context bar
			vis.append("defs").append("clipPath")
				.attr("id", "clip")
				.append("rect")
				.attr("width", WIDTH)
				.attr("height", HEIGHT);

			// ******** Multi-line graph creation *********

			// Source of information
			d3.csv("https://fvargaspiedra.github.io/FRbyCountry.csv", function(data) {	
				// Parse Year and convert Fertility Rate into number
				data.forEach(function(d) {
					d.Fertility_Rate = +d.Fertility_Rate;
					d.Year = parseDate(d.Year);
				});

				// Nest data based on Country Name
				var dataGroup = d3.nest()
				    .key(function(d) {
				        return d.Country_Name;
				    })
				    .entries(data);

				// Nest data based on Region
				var dataRegion = d3.nest()
				    .key(function(d) {
				        return d.Region;
				    })
				    .entries(data);

				// Set domain for ranges dynamically based on data
				xScale.domain([d3.min(data, function(d) { return d.Year; }), d3.max(data, function(d) { return d.Year; })])
				yScale.domain([0, d3.max(data, function(d) { return d.Fertility_Rate; }) + 1]);
				xScale2.domain(xScale.domain());
				yScale2.domain(yScale.domain());

				// For each Country Name draw a line graph
				dataGroup.forEach(function(d, i) {
					// add the dots with tooltips
					points.selectAll("dot")
						.data(d.values)
						.enter().append("circle")
						.attr("r", 2.5)
						.attr("cx", function(v) { return xScale(v.Year); })
						.attr("cy", function(v) { return yScale(v.Fertility_Rate); })
						.attr("class", "line")
						.attr('id', function(v) { return 'point_'+v.Region.replace(/\s+/g, ''); })
						.attr('clip-path', 'url(#clip)')
						.on("mouseover", function(v) {
							div.transition()
								.duration(200)
								.style("opacity", .9);
							div.html("<b style='font-size:12px; color:#333333'>" + v.Country_Name + "</b><br/><b>Year: </b>" + formatTime(v.Year) + "<br/><b>FR: </b>" + v.Fertility_Rate)
								.style("left", (d3.event.pageX) + "px")
								.style("top", (d3.event.pageY - 28) + "px");
						})
						.on("mouseout", function(v) {
							div.transition()
							.duration(500)
							.style("opacity", 0);
						});
					// Draw the line graph on focus section
					focus.append("path")
						.datum(d.values)
						.attr("class", "line")
					    .attr('stroke-width', 1)
					    .attr('fill', 'none')
					    // Set ID with region to each line to easily filter
					    .attr('id', 'line_'+d.values[0].Region.replace(/\s+/g, ''))
					    .attr('clip-path', 'url(#clip)')
						.attr("d", lineGen(d.values));
					// Draw the line grapsh on context section
					context.append("path")
						.datum(d.values)
						.attr("class", "line")
						.attr('stroke-width', 1)
					    .attr('fill', 'none')
					    // Set ID with region to each line to easily filter
					    .attr('id', 'line_'+d.values[0].Region.replace(/\s+/g, ''))
					    .attr('clip-path', 'url(#clip)')
						.attr("d", lineGen2(d.values));
				});

				// For each Region add a legend
				dataRegion.forEach(function(d, i) {
					// Create legend for each region
					vis.append("text")
						.attr("class", "legend")
						.attr("x", WIDTH + MARGINS.left + 30)
						.attr("y", HEIGHT/2 + i * 20)
						.style("fill", "black")
						.text(d.key)
						.attr('id', 'legendText_'+d.values[0].Region.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var opacity = active ? 0 : 1;
							var legendOpacity = active ? 0.3 : 1;
							var shadow = active ? "none" : "2px 2px 2px #aaa";
							var radius = active ? 0 : 2.5;
							d3.selectAll("#line_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", opacity);
							d3.selectAll("#point_"+d.values[0].Region.replace(/\s+/g, '')).attr("r", radius);
							d3.selectAll("#legendColor_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity).style("text-shadow", shadow);
							d.active = active;
						});
					vis.append("rect")
						.attr("x", WIDTH + MARGINS.left + 15)
						.attr("y", HEIGHT/2 + i * 20 - 10)
						.attr('fill', color(i))
						.attr("width", 10)
						.attr("height", 10)
						.attr('id', 'legendColor_'+d.values[0].Region.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var opacity = active ? 0 : 1;
							var legendOpacity = active ? 0.3 : 1;
							var radius = active ? 0 : 2.5;
							d3.selectAll("#line_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", opacity);
							d3.selectAll("#point_"+d.values[0].Region.replace(/\s+/g, '')).attr("r", radius);
							d3.selectAll("#legendColor_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d.active = active;
						});
					// Set line color by region
					focus.selectAll("#line_"+d.values[0].Region.replace(/\s+/g, '')).attr('stroke', color(i));
					context.selectAll("#line_"+d.values[0].Region.replace(/\s+/g, '')).attr('stroke', color(i));
					points.selectAll("#point_"+d.values[0].Region.replace(/\s+/g, '')).attr('fill', color(i));
				});

				// Set X axis to focus section
				focus.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT + ")")
					.call(xAxis);

				// Set Y axis to focus section
				focus.append("g")
					.attr("class", "axis axis--y")
					.call(yAxis);

				// Set X axis to focus section
				context.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT2 + ")")
					.call(xAxis2);

				// Set brush call for context bar
				context.append("g")
					.attr("class", "brush")
					.call(brush)
					.call(brush.move, xScale.range());

				// X Axis label
				context.append("text")
					.attr("transform", "translate(" + (WIDTH/2) + "," + (HEIGHT2 + 40) + ")")
					.style("text-anchor", "middle")
					.text("Year");

				// Y Axis label
				vis.append("text")
					.attr("transform", "rotate(-90), translate(" + (-1 * HEIGHT / 2 ) + ", 20)")
					.style("text-anchor", "middle")
					.text("Fertility Rate (births per woman)"); 

				// add the X gridlines
				focus.append("g")			
					.attr("class", "grid")
					.attr("transform", "translate(0," + HEIGHT + ")")
					.call(make_x_gridlines()
						.tickSize(-HEIGHT)
						.tickFormat("")
					)

				// add the Y gridlines
				focus.append("g")			
					.attr("class", "grid")
					.call(make_y_gridlines()
						.tickSize(-WIDTH)
						.tickFormat("")
					)   
			});

			// Refresh ranges and line graphs on focus section for brushing action
			function brushed() {
				var s = d3.event.selection || xScale2.range();
				xScale.domain(s.map(xScale2.invert, xScale2));
				focus.selectAll(".line").attr("d", lineGen);
				points.selectAll(".line")
					.attr("cx", function(v) { return xScale(v.Year); })
					.attr("cy", function(v) { return yScale(v.Fertility_Rate); })
				focus.select(".grid").call(make_x_gridlines()
						.tickSize(-HEIGHT)
						.tickFormat("")
					);
				focus.select(".axis--x").call(xAxis);
			}

			// ***************************************************
			// ********** FERTILITY RATE VS HAPPINESS ************
			// ***************************************************

			// ******** Variable definition *********	

			var div_2 = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);

			// SVG to be modified selection
			var vis_2 = d3.select("#FertilityRateVsHapiness");

			// Dimensions
			var	MARGINS_2 = { top: 20, right: 300, bottom: 130, left: 50 },
				MARGINS2_2 = { top: 410, right: 300, bottom: 50, left: 50 },
				WIDTH_2 = +vis_2.attr("width") - MARGINS_2.left - MARGINS_2.right,
				HEIGHT_2 = +vis_2.attr("height") - MARGINS_2.top - MARGINS_2.bottom,
				HEIGHT2_2 = +vis_2.attr("height") - MARGINS2_2.top - MARGINS2_2.bottom;

			// Scales
			var xScale_2 = d3.scaleLinear().range([0, WIDTH_2]),
				xScale2_2 = d3.scaleLinear().range([0, WIDTH_2]),
				yScale_2 = d3.scaleLinear().range([HEIGHT_2, 0]),
				yScale2_2 = d3.scaleLinear().range([HEIGHT2_2, 0]);

			// gridlines in x axis function
			function make_x_gridlines_2() {		
			    return d3.axisBottom(xScale_2)
			        .ticks(10)
			}

			// gridlines in y axis function
			function make_y_gridlines_2() {		
			    return d3.axisLeft(yScale_2)
			        .ticks(10)
			}

			// Axis
			var	xAxis_2 = d3.axisBottom(xScale_2),
				xAxis2_2 = d3.axisBottom(xScale2_2),
				yAxis_2 = d3.axisLeft(yScale_2);

			// Line color
			var color_2 = d3.scaleOrdinal(d3.schemeCategory10);

			// Define brush call
			var brush_2 = d3.brushX()
			    .extent([[0, 0], [WIDTH_2, HEIGHT2_2]])
			    .on("brush end", brushed_2);

			// Append class context that will be used to draw the charts in the context bar
			var context_2 = vis_2.append("g")
			    .attr("class", "context_2")
			    .attr("transform", "translate(" + MARGINS2_2.left + "," + MARGINS2_2.top + ")");

			// Append class context that will be used to draw the points in the focus bar
			var points_2 = vis_2.append("g")
			    .attr("class", "points_2")
			    .attr("transform", "translate(" + MARGINS_2.left + "," + MARGINS_2.top + ")");

			// ******** Append section *********	

			// clipPath for context bar
			vis_2.append("defs").append("clipPath")
				.attr("id", "clip_2")
				.append("rect")
				.attr("width", WIDTH_2)
				.attr("height", HEIGHT_2);

			// ******** Scatter plot graph creation *********

			// Source of information
			d3.csv("https://fvargaspiedra.github.io/FRvsHappiness.csv", function(data) {	
				// Parse Year and convert Fertility Rate into number
				data.forEach(function(d) {
					d.Fertility_Rate = +d.Fertility_Rate;
					d.Happiness_Score = +d.Happiness_Score;
				});

				// Nest data based on Region
				var dataRegion_2 = d3.nest()
				    .key(function(d) {
				        return d.Region;
				    })
				    .entries(data);

				// Set domain for ranges dynamically based on data
				xScale_2.domain([d3.min(data, function(d) { return d.Happiness_Score; }) - 0.1, d3.max(data, function(d) { return d.Happiness_Score; }) + 0.1])
				yScale_2.domain([0, d3.max(data, function(d) { return d.Fertility_Rate; }) + 1]);
				xScale2_2.domain(xScale_2.domain());
				yScale2_2.domain(yScale_2.domain());

				// add the X gridlines
				points_2.append("g")			
					.attr("class", "grid")
					.attr("transform", "translate(0," + HEIGHT_2 + ")")
					.call(make_x_gridlines_2()
						.tickSize(-HEIGHT_2)
						.tickFormat("")
					)

				// add the Y gridlines
				points_2.append("g")			
				.attr("class", "grid")
				.call(make_y_gridlines_2()
					.tickSize(-WIDTH_2)
					.tickFormat("")
				) 

				// Add the dots with tooltips
				points_2.selectAll("dot")
					.data(data)
					.enter().append("circle")
					.attr("r", 4)
					.attr("cx", function(v) { return xScale_2(v.Happiness_Score); })
					.attr("cy", function(v) { return yScale_2(v.Fertility_Rate); })
					.attr("class", "line_2")
					.attr('id', function(v) { return 'point_2_'+v.Region.replace(/\s+/g, ''); } )
					.attr('clip-path', 'url(#clip_2)')
					.on("mouseover", function(v) {
						div_2.transition()
							.duration(200)
							.style("opacity", .9);
						div_2.html("<b style='font-size:12px; color:#333333'>" + v.Country_Name + "</b><br/><b>Year: 2015</b><br/><b>Fertility Rate: </b>" + v.Fertility_Rate + "<br/><b>Happiness Score: </b>" + v.Happiness_Score)
							.style("left", (d3.event.pageX) + "px")
							.style("top", (d3.event.pageY - 28) + "px");
					})
					.on("mouseout", function(v) {
						div_2.transition()
						.duration(500)
						.style("opacity", 0);
					});
				// Draw the scatter graph on context section
				context_2.selectAll("dot")
					.data(data)
					.enter().append("circle")
					.attr("r", 2.5)
					.attr("cx", function(v) { return xScale2_2(v.Happiness_Score); })
					.attr("cy", function(v) { return yScale2_2(v.Fertility_Rate); })
					.attr("class", "line_2")
					.attr('id', function(v) { return 'point_2_'+v.Region.replace(/\s+/g, '') } )
					.attr('clip-path', 'url(#clip_2)');

				// For each Region add a legend
				dataRegion_2.forEach(function(d, i) {
					// Create legend for each region
					vis_2.append("text")
						.attr("class", "legend")
						.attr("x", WIDTH_2 + MARGINS_2.left + 30)
						.attr("y", HEIGHT_2/2 + i * 20)
						.style("fill", "black")
						.text(d.key)
						.attr('id', 'legendText_2_'+d.values[0].Region.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_2_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_2_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_2_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_2_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var opacity = active ? 0 : 1;
							var legendOpacity = active ? 0.3 : 1;
							var shadow = active ? "none" : "2px 2px 2px #aaa";
							var radius = active ? 0 : 4;
							d3.selectAll("#line_2_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", opacity);
							d3.selectAll("#point_2_"+d.values[0].Region.replace(/\s+/g, '')).attr("r", radius);
							d3.selectAll("#legendColor_2_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_2_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity).style("text-shadow", shadow);
							d.active = active;
						});
					vis_2.append("rect")
						.attr("x", WIDTH_2 + MARGINS_2.left + 15)
						.attr("y", HEIGHT_2/2 + i * 20 - 10)
						.attr('fill', color(i))
						.attr("width", 10)
						.attr("height", 10)
						.attr('id', 'legendColor_2_'+d.values[0].Region.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_2_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_2_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_2_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_2_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var opacity = active ? 0 : 1;
							var legendOpacity = active ? 0.3 : 1;
							var radius = active ? 0 : 4;
							d3.selectAll("#line_2_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", opacity);
							d3.selectAll("#point_2_"+d.values[0].Region.replace(/\s+/g, '')).attr("r", radius);
							d3.selectAll("#legendColor_2_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_2_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d.active = active;
						});
					// Set line color by region
					context_2.selectAll("#point_2_"+d.values[0].Region.replace(/\s+/g, '')).attr('fill', color_2(i));
					points_2.selectAll("#point_2_"+d.values[0].Region.replace(/\s+/g, '')).attr('fill', color_2(i));
				});

				// Set X axis to focus section
				points_2.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT_2 + ")")
					.call(xAxis_2);

				// Set Y axis to focus section
				points_2.append("g")
					.attr("class", "axis axis--y")
					.call(yAxis_2);

				// Set X axis to focus section
				context_2.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT2_2 + ")")
					.call(xAxis2_2);

				// Set brush call for context bar
				context_2.append("g")
					.attr("class", "brush_2")
					.call(brush_2)
					.call(brush_2.move, xScale_2.range());

				// X Axis label
				context_2.append("text")
					.attr("transform", "translate(" + (WIDTH_2/2) + "," + (HEIGHT2_2 + 40) + ")")
					.style("text-anchor", "middle")
					.text("Happiness Score");

				// Y Axis label
				vis_2.append("text")
					.attr("transform", "rotate(-90), translate(" + (-1 * HEIGHT_2 / 2 ) + ", 20)")
					.style("text-anchor", "middle")
					.text("Fertility Rate (births per woman)");     
			});

			// Refresh ranges and line graphs on focus section for brushing action
			function brushed_2() {
				var s = d3.event.selection || xScale2_2.range();
				xScale_2.domain(s.map(xScale2_2.invert, xScale2_2));
				points_2.selectAll(".line_2")
					.attr("cx", function(v) { return xScale_2(v.Happiness_Score); })
					.attr("cy", function(v) { return yScale_2(v.Fertility_Rate); });
				points_2.select(".axis--x").call(xAxis_2);
				points_2.select(".grid").call(make_x_gridlines_2()
						.tickSize(-HEIGHT_2)
						.tickFormat("")
					);
			}

			// ************************************************************
			// *********** FERTILITY RATE VS GDP PER CAPITA ***************
			// ************************************************************

			// ******** Variable definition *********	

			var div_3 = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);

			// SVG to be modified selection
			var vis_3 = d3.select("#FertilityRateVsGDP");

			// Dimensions
			var	MARGINS_3 = { top: 20, right: 210, bottom: 50, left: 50 },
				WIDTH_3 = +vis_3.attr("width") - MARGINS_3.left - MARGINS_3.right,
				HEIGHT_3 = +vis_3.attr("height") - MARGINS_3.top - MARGINS_3.bottom;

			// Scales
			var xScale_3 = d3.scaleLinear().range([0, WIDTH_3]),
				yScale_3 = d3.scaleLinear().range([HEIGHT_3, 0]);

			// gridlines in x axis function
			function make_x_gridlines_3() {		
			    return d3.axisBottom(xScale_3)
			        .ticks(10)
			}

			// gridlines in y axis function
			function make_y_gridlines_3() {		
			    return d3.axisLeft(yScale_3)
			        .ticks(10)
			}

			// Axis
			var	xAxis_3 = d3.axisBottom(xScale_3),
				yAxis_3 = d3.axisLeft(yScale_3);

			// Line color
			var color_3 = d3.scaleOrdinal(d3.schemeCategory10);

			// Append class context that will be used to draw the points in the focus bar
			var points_3 = vis_3.append("g")
			    .attr("class", "points_3")
			    .attr("transform", "translate(" + MARGINS_3.left + "," + MARGINS_3.top + ")");

			// ******** Append section *********	

			// clipPath for context bar
			vis_3.append("defs").append("clipPath")
				.attr("id", "clip_3")
				.append("rect")
				.attr("width", WIDTH_3)
				.attr("height", HEIGHT_3);

			// ******** Scatter plot graph creation *********

			// Source of information
			d3.csv("https://fvargaspiedra.github.io/FRandGDP.csv", function(data) {	
				// Parse Year and convert Fertility Rate into number
				data.forEach(function(d) {
					d.Fertility_Rate = +d.Fertility_Rate;
					d.GDP_Per_Capita = +d.GDP_Per_Capita;
				});

				// Nest data based on Year
				var dataGroup_3 = d3.nest()
				    .key(function(d) {
				        return d.Year;
				    })
				    .entries(data);

				// Nest data based on Region
				var dataRegion_3 = d3.nest()
				    .key(function(d) {
				        return d.Region;
				    })
				    .entries(data);

				// Set domain for ranges dynamically based on data
				xScale_3.domain([d3.min(data, function(d) { return d.GDP_Per_Capita; }) - 100, d3.max(data, function(d) { return d.GDP_Per_Capita; }) + 5000])
				yScale_3.domain([0, d3.max(data, function(d) { return d.Fertility_Rate; }) + 1]);

				// add the X gridlines
				points_3.append("g")			
					.attr("class", "grid")
					.attr("transform", "translate(0," + HEIGHT_3 + ")")
					.call(make_x_gridlines_3()
						.tickSize(-HEIGHT_3)
						.tickFormat("")
					)

				// add the Y gridlines
				points_3.append("g")			
				.attr("class", "grid")
				.call(make_y_gridlines_3()
					.tickSize(-WIDTH_3)
					.tickFormat("")
				) 

				// Max GDP value to calculate radius
				var maxGDP = d3.max(data, function(d) { return d.GDP_Per_Capita; });

				var sliderValue = $("#slider").val();

				// For each Country Name draw a line graph
				dataGroup_3.forEach(function(d, i) {
					if(d.key==$("#slider").val()) {
						// Add the dots with tooltips
						points_3.selectAll("dot")
							.data(d.values)
							.enter().append("circle")
							.attr("r", function(v) {
								if(v.GDP_Per_Capita == -1 || v.Fertility_Rate == -1) {
									return 0;
								} else {
									return (v.GDP_Per_Capita * 12 / maxGDP) + 1;
								} 
							})
							.attr("cx", function(v) { 
								if(v.GDP_Per_Capita == -1 || v.Fertility_Rate == -1) {
									return 0;
								} else {
									return xScale_3(v.GDP_Per_Capita);
								}
							})
							.attr("cy", function(v) {
								if(v.GDP_Per_Capita == -1 || v.Fertility_Rate == -1) {
									return 0;
								} else {
									return yScale_3(v.Fertility_Rate);
								}
							})
							.classed("line_3", true)
							.attr('id', function(v) { return 'point_3_'+v.Region.replace(/\s+/g, ''); } )
							.attr('clip-path', 'url(#clip_3)')
							.on("mouseover", function(v) {
								div_3.transition()
									.duration(200)
									.style("opacity", .9);
								div_3.html("<b style='font-size:12px; color:#333333'>" + v.Country_Name + "</b><br/><b>Fertility Rate: </b>" + v.Fertility_Rate + "<br/><b>GDP Per Capita: </b>" + v.GDP_Per_Capita)
									.style("left", (d3.event.pageX) + "px")
									.style("top", (d3.event.pageY - 28) + "px");
							})
							.on("mouseout", function(v) {
								div_3.transition()
								.duration(500)
								.style("opacity", 0);
							});
					}
				});

				// For each Region add a legend
				dataRegion_3.forEach(function(d, i) {
					// Create legend for each region
					vis_3.append("text")
						.attr("class", "legend")
						.attr("x", WIDTH_3 + MARGINS_3.left + 30)
						.attr("y", HEIGHT_3/2 + i * 20)
						.style("fill", "black")
						.text(d.key)
						.attr('id', 'legendText_3_'+d.values[0].Region.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_3_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_3_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_3_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_3_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var legendOpacity = active ? 0.3 : 1;
							var shadow = active ? "none" : "2px 2px 2px #aaa";
							var opacity = active ? d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).attr("opacity", 0) : d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).attr("opacity", 1);
							var pointerEvent = active ? d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).style("pointer-events", "none") : d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).style("pointer-events", "auto");
							d3.selectAll("#legendColor_3_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_3_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity).style("text-shadow", shadow);
							d.active = active;
						});
					vis_3.append("rect")
						.attr("x", WIDTH_3 + MARGINS_3.left + 15)
						.attr("y", HEIGHT_3/2 + i * 20 - 10)
						.attr('fill', color(i))
						.attr("width", 10)
						.attr("height", 10)
						.attr('id', 'legendColor_3_'+d.values[0].Region.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_3_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_3_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_3_"+d.values[0].Region.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_3_"+d.values[0].Region.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var legendOpacity = active ? 0.3 : 1;
							var shadow = active ? "none" : "2px 2px 2px #aaa";
							var opacity = active ? d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).attr("opacity", 0) : d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).attr("opacity", 1);
							var pointerEvent = active ? d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).style("pointer-events", "none") : d3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).style("pointer-events", "auto");
							d3.selectAll("#legendColor_3_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_3_"+d.values[0].Region.replace(/\s+/g, '')).style("opacity", legendOpacity).style("text-shadow", shadow);
							d.active = active;
						});
					// Set line color by region
					points_3.selectAll("#point_3_"+d.values[0].Region.replace(/\s+/g, '')).attr('fill', color_3(i));
				});

				// Set X axis to focus section
				points_3.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT_3 + ")")
					.call(xAxis_3);

				// Set Y axis to focus section
				points_3.append("g")
					.attr("class", "axis axis--y")
					.call(yAxis_3);

				// X Axis label
				points_3.append("text")
					.attr("transform", "translate(" + (WIDTH_3/2) + "," + (HEIGHT_3 + 40) + ")")
					.style("text-anchor", "middle")
					.text("GDP Per Capita (US Dollar)");

				// Y Axis label
				vis_3.append("text")
					.attr("transform", "rotate(-90), translate(" + (-1 * HEIGHT_3 / 2 ) + ", 20)")
					.style("text-anchor", "middle")
					.text("Fertility Rate (births per woman)");    
	
				var running = false;
				var timer;

				$("button").on("click", function() {
					var duration = 300,
					maxstep = 2015,
					minstep = 1960;
					if (running == true) {
						$("button").html("Play");
						running = false;
						clearInterval(timer);
					} else if (running == false) {
						$("button").html("Pause");
						sliderValue = $("#slider").val();
						timer = setInterval( function(){
							if (sliderValue < maxstep){
								sliderValue++;
								$("#slider").val(sliderValue);
								$('#range').html(sliderValue);
							} else {
								$("button").html("Play");
								running = false;
								clearInterval(timer);
							}
							$("#slider").val(sliderValue);
							update();
						} , duration);
						running = true;
					}
				});

				$("#slider").on("change", function(){
					update();
					$("#range").html($("#slider").val());
					clearInterval(timer);
					$("button").html("Play");
					running = false;
				});

				update = function() {
					// For each Country Name draw a line graph
					dataGroup_3.forEach(function(d, i) {
						if(d.key==$("#slider").val()) {
							points_3.selectAll(".line_3")
								.data(d.values)
								//.transition()
								//.duration(1000)
								.attr("r", function(v) {
									if(v.GDP_Per_Capita == -1 || v.Fertility_Rate == -1) {
										return 0;
									} else {
										return (v.GDP_Per_Capita * 12 / maxGDP) + 1;
									} 
								})
								.attr("cx", function(v) { 
									if(v.GDP_Per_Capita == -1 || v.Fertility_Rate == -1) {
										return 0;
									} else {
										return xScale_3(v.GDP_Per_Capita);
									}
								})
								.attr("cy", function(v) {
									if(v.GDP_Per_Capita == -1 || v.Fertility_Rate == -1) {
										return 0;
									} else {
										return yScale_3(v.Fertility_Rate);
									}
								});
						}
					});
				}

			});	

			// ***************************************************
			// *********** FERTILITY RATE VS RELIGION ************
			// ***************************************************

			// ******** Variable definition *********	
			
			var div_4 = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);

			// Parse time for yearly data		
			var parseDate = d3.timeParse("%Y");
			var formatTime = d3.timeFormat("%Y");

			// SVG to be modified selection
			var vis_4 = d3.select("#FertilityRateVsReligion");

			// Dimensions
			var	MARGINS_4 = { top: 20, right: 200, bottom: 130, left: 50 },
				MARGINS2_4 = { top: 410, right: 200, bottom: 50, left: 50 },
				WIDTH_4 = +vis.attr("width") - MARGINS_4.left - MARGINS_4.right,
				HEIGHT_4 = +vis.attr("height") - MARGINS_4.top - MARGINS_4.bottom,
				HEIGHT2_4 = +vis.attr("height") - MARGINS2_4.top - MARGINS2_4.bottom;

			// Scales
			var xScale_4 = d3.scaleTime().range([0, WIDTH_4]),
				xScale2_4 = d3.scaleTime().range([0, WIDTH_4]),
				yScale_4 = d3.scaleLinear().range([HEIGHT_4, 0]),
				yScale2_4 = d3.scaleLinear().range([HEIGHT2_4, 0]);

			// gridlines in x axis function
			function make_x_gridlines_4() {		
			    return d3.axisBottom(xScale_4)
			        .ticks(10)
			}

			// gridlines in y axis function
			function make_y_gridlines_4() {		
			    return d3.axisLeft(yScale_4)
			        .ticks(10)
			}

			// Axis
			var	xAxis_4 = d3.axisBottom(xScale_4),
				xAxis2_4 = d3.axisBottom(xScale2_4),
				yAxis_4 = d3.axisLeft(yScale_4);

			// Line color
			var color_4 = d3.scaleOrdinal(d3.schemeCategory10);

			// Define brush call
			var brush_4 = d3.brushX()
			    .extent([[0, 0], [WIDTH_4, HEIGHT2_4]])
			    .on("brush end", brushed_4);

			// Append class focus that will be used to draw the charts
			var focus_4 = vis_4.append("g")
			    .attr("class", "focus_4")
			    .attr("transform", "translate(" + MARGINS_4.left + "," + MARGINS_4.top + ")");

			// Append class context that will be used to draw the charts in the context bar
			var context_4 = vis_4.append("g")
			    .attr("class", "context_4")
			    .attr("transform", "translate(" + MARGINS2_4.left + "," + MARGINS2_4.top + ")");

			// Append class context that will be used to draw the points in the focus bar
			var points_4 = vis_4.append("g")
			    .attr("class", "points_4")
			    .attr("transform", "translate(" + MARGINS_4.left + "," + MARGINS_4.top + ")");

			// Line definition for focus section
			var lineGen_4 = d3.line()
				.x(function(d) { return xScale_4(d.Year); })
				.y(function(d) { return yScale_4(d.Avg_Fertility_Rate); });

			// Line definition for context section
			var lineGen2_4 = d3.line()
				.x(function(d) { return xScale2_4(d.Year); })
				.y(function(d) { return yScale2_4(d.Avg_Fertility_Rate); });

			// ******** Append section *********	

			// clipPath for context bar
			vis_4.append("defs").append("clipPath")
				.attr("id", "clip_4")
				.append("rect")
				.attr("width", WIDTH_4)
				.attr("height", HEIGHT_4);

			// ******** Multi-line graph creation *********

			// Source of information
			d3.csv("https://fvargaspiedra.github.io/FRvsReligion.csv", function(data) {	
				// Parse Year and convert Fertility Rate into number
				data.forEach(function(d) {
					d.Avg_Fertility_Rate = +d.Avg_Fertility_Rate;
					d.Year = parseDate(d.Year);
				});

				// Nest data based on Country Name
				var dataGroup_4 = d3.nest()
				    .key(function(d) {
				        return d.Religion;
				    })
				    .entries(data);

				// Set domain for ranges dynamically based on data
				xScale_4.domain([d3.min(data, function(d) { return d.Year; }), d3.max(data, function(d) { return d.Year; })])
				yScale_4.domain([0, d3.max(data, function(d) { return d.Avg_Fertility_Rate; }) + 1]);
				xScale2_4.domain(xScale_4.domain());
				yScale2_4.domain(yScale_4.domain());

				// add the X gridlines
				focus_4.append("g")			
					.attr("class", "grid")
					.attr("transform", "translate(0," + HEIGHT_4 + ")")
					.call(make_x_gridlines_4()
						.tickSize(-HEIGHT_4)
						.tickFormat("")
					)

				// add the Y gridlines
				focus_4.append("g")			
					.attr("class", "grid")
					.call(make_y_gridlines_4()
						.tickSize(-WIDTH_4)
						.tickFormat("")
					) 

				// For each Country Name draw a line graph
				dataGroup_4.forEach(function(d, i) {
					// add the dots with tooltips
					points_4.selectAll("dot")
						.data(d.values)
						.enter().append("circle")
						.attr('fill', color(i))
						.attr("r", 4.5)
						.attr("cx", function(v) { return xScale_4(v.Year); })
						.attr("cy", function(v) { return yScale_4(v.Avg_Fertility_Rate); })
						.attr("class", "line_4")
						.attr('id', 'point_4_'+d.values[0].Religion.replace(/\s+/g, ''))
						.attr('clip-path', 'url(#clip_4)')
						.on("mouseover", function(v) {
							div_4.transition()
								.duration(200)
								.style("opacity", .9);
							div_4.html("<b style='font-size:12px; color:#333333'>" + v.Religion + "</b><br/><b>Year: </b>" + formatTime(v.Year) + "<br/><b>Avg. Fertility Rate: </b>" + v.Avg_Fertility_Rate)
								.style("left", (d3.event.pageX) + "px")
								.style("top", (d3.event.pageY - 28) + "px");
						})
						.on("mouseout", function(v) {
							div_4.transition()
							.duration(500)
							.style("opacity", 0);
						});
					// Draw the line graph on focus section
					focus_4.append("path")
						.datum(d.values)
						.attr("class", "line_4")
					    .attr('stroke-width', 1)
					    .attr('fill', 'none')
					    .attr('stroke', color(i))
					    // Set ID with region to each line to easily filter
					    .attr('id', 'line_4_'+d.values[0].Religion.replace(/\s+/g, ''))
					    .attr('clip-path', 'url(#clip_4)')
						.attr("d", lineGen_4(d.values));
					// Draw the line grapsh on context section
					context_4.append("path")
						.datum(d.values)
						.attr("class", "line_4")
						.attr('stroke-width', 1)
					    .attr('fill', 'none')
					    .attr('stroke', color(i))
					    // Set ID with region to each line to easily filter
					    .attr('id', 'line_4_'+d.values[0].Religion.replace(/\s+/g, ''))
					    .attr('clip-path', 'url(#clip_4)')
						.attr("d", lineGen2_4(d.values));
					// Create legend for each region
					vis_4.append("text")
						.attr("class", "legend")
						.attr("x", WIDTH_4 + MARGINS_4.left + 30)
						.attr("y", HEIGHT_4/2 + i * 20)
						.style("fill", "black")
						.text(d.key)
						.attr('id', 'legendText_4_'+d.values[0].Religion.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var opacity = active ? 0 : 1;
							var radius = active ? 0 : 4.5;
							var legendOpacity = active ? 0.3 : 1;
							var shadow = active ? "none" : "2px 2px 2px #aaa";
							d3.selectAll("#line_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("opacity", opacity);
							d3.selectAll("#point_4_"+d.values[0].Religion.replace(/\s+/g, '')).attr("r", radius);
							d3.selectAll("#legendColor_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("opacity", legendOpacity).style("text-shadow", shadow);
							d.active = active;
						});
					vis_4.append("rect")
						.attr("x", WIDTH_4 + MARGINS_4.left + 15)
						.attr("y", HEIGHT_4/2 + i * 20 - 10)
						.attr('fill', color(i))
						.attr("width", 10)
						.attr("height", 10)
						.attr('id', 'legendColor_4_'+d.values[0].Religion.replace(/\s+/g, ''))
						.on("mouseover", function(v) {
							var shadow = "2px 2px 2px #808080";
							d3.selectAll("#legendColor_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("stroke-width", 1).style("stroke", "black");
							d3.selectAll("#legendText_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on("mouseout", function(v) {
							var shadow = "2px 2px 2px #aaa";
							d3.selectAll("#legendColor_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("stroke-width", 0).style("stroke", "none");
							d3.selectAll("#legendText_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("text-shadow", shadow);
						})
						.on('click', function() {
							var active = d.active ? false : true;
							var opacity = active ? 0 : 1;
							var radius = active ? 0 : 4.5;
							var legendOpacity = active ? 0.3 : 1;
							var shadow = active ? "none" : "2px 2px 2px #aaa";
							d3.selectAll("#line_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("opacity", opacity);
							d3.selectAll("#point_4_"+d.values[0].Religion.replace(/\s+/g, '')).attr("r", radius);
							d3.selectAll("#legendColor_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("opacity", legendOpacity);
							d3.selectAll("#legendText_4_"+d.values[0].Religion.replace(/\s+/g, '')).style("opacity", legendOpacity).style("text-shadow", shadow);
							d.active = active;
						});
				});

				// Set X axis to focus section
				focus_4.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT_4 + ")")
					.call(xAxis_4);

				// Set Y axis to focus section
				focus_4.append("g")
					.attr("class", "axis axis--y")
					.call(yAxis_4);

				// Set X axis to focus section
				context_4.append("g")
					.attr("class", "axis axis--x")
					.attr("transform", "translate(0," + HEIGHT2_4 + ")")
					.call(xAxis2_4);

				// Set brush call for context bar
				context_4.append("g")
					.attr("class", "brush_4")
					.call(brush_4)
					.call(brush_4.move, xScale_4.range());

				// X Axis label
				context_4.append("text")
					.attr("transform", "translate(" + (WIDTH_4/2) + "," + (HEIGHT2_4 + 40) + ")")
					.style("text-anchor", "middle")
					.text("Year");

				// Y Axis label
				vis_4.append("text")
					.attr("transform", "rotate(-90), translate(" + (-1 * HEIGHT_4 / 2 ) + ", 20)")
					.style("text-anchor", "middle")
					.text("Avg. Fertility Rate (births per woman)");    
			});

			// Refresh ranges and line graphs on focus section for brushing action
			function brushed_4() {
				var s = d3.event.selection || xScale2_4.range();
				xScale_4.domain(s.map(xScale2_4.invert, xScale2_4));
				focus_4.selectAll(".line_4").attr("d", lineGen_4);
				points_4.selectAll(".line_4")
					.attr("cx", function(v) { return xScale_4(v.Year); })
					.attr("cy", function(v) { return yScale_4(v.Avg_Fertility_Rate); })
				focus_4.select(".grid").call(make_x_gridlines_4()
						.tickSize(-HEIGHT_4)
						.tickFormat("")
					);
				focus_4.select(".axis--x").call(xAxis_4);
			}	
		</script>
	</body>
</html>
